import{d as O,R as U,U as W,a2 as G,$ as H,i as P,c as Y,r as d,a3 as Z,a4 as K,Y as L,z as k,a as r,b as c,j as v,l as Q,q as y,f as _,w as t,n as z,k as J,F as R,e as S,h as u,B as m,Z as X,G as x,H as ee,E as le,a5 as ae,a6 as ue,a7 as te,a8 as oe,a9 as ne,aa as se,ab as ie,N as re,M as de,v as me}from"./main-7e53c33c.js";/* empty css                */import fe from"./starfish-form-cc706b67-a323419a.js";import{c as ce}from"./vue-codemirror.esm-20411d75.js";const pe=O({ControlType:"Rule",rule:U.getJsonValidate(),props:{...W},components:{Delete:G,Dynamicform:fe,Codemirror:ce},setup(e){const{proxy:l}=H(),{formStore:w}=P("control")||{},V=Y(()=>w?.get("globalDatas")),A=d([]),B=d(Z),D=d({}),p=d({}),C=d({}),o=d({}),b=d(K.ruleJson),h=d(!0),F=d(),g=d(),E=d();return{IsShow:h,rules:A,ruleList:B,globalDatas:V,funcItem:D,funcValue:p,highItem:C,formValue:o,ruleJson:b,codeMyDialog:F,formRuleDialog:g,formdragger:E,handleDropdown(a){let n="";a=="enum"?n="自定义枚举":a=="func"?n="自定义函数规则":a=="high"&&(n="高级模式"),Array.isArray(e.data[e.item.data.fieldName])?e.data[e.item.data.fieldName].push({type:a,title:n,value:""}):(e.data[e.item.data.fieldName]=[],e.data[e.item.data.fieldName].push({type:a,title:n,value:""}))},handleFuncEdit(a){D.value=a,p.value=a.value?JSON.parse(JSON.stringify(a.value)):{trigger:"blur",func:`/** if (value === "" || value == null) {
*  callback(new Error("请输入"));
*} else if (!/^[0-9]*$/.test(value)) {
*  callback(new Error("必须为数字"));
*}
*callback(); 
*/`},F.value.init("函数编辑","icon-icon-bianji"),F.value.show()},saveFunc(){D.value.value=p.value,l.closeDialog()},closeDialog(){F.value.close(),g.value.close()},deleteRule(a){e.data[e.item.data.fieldName].splice(a,1)},async handleFormEdit(a){C.value=a,o.value=a.value||l.getDefaultData(b.value);debugger;g.value.init("规则表单编辑","icon-icon-bianji"),g.value.show()},getDefaultData(a){const n={};return a.forEach(s=>{n[s.data.fieldName]=s.data.default,s.data.getDefault&&(n[s.data.fieldName]=s.data.getDefault()),s.data.itemConfig&&(n[s.data.fieldName]=s.data.itemConfig.value),n[s.data.fieldName]=n[s.data.fieldName]!=null?JSON.parse(JSON.stringify(n[s.data.fieldName])):void 0}),n},saveField(){const a={},n={1:{fields:["required","trigger","message"]},2:{fields:["trigger","min","max","message"]},3:{fields:["required","trigger","type","message"]},4:{fields:["required","trigger","patternTemp","message"]},5:{fields:["trigger","minValue","maxValue","message"]}};for(const s in o.value)n[o.value.ruleType||"1"].fields.includes(s)&&(a[s]=o.value[s]);o.value.ruleType==2?(a.min=parseInt(a.min),a.max=parseInt(a.max)):o.value.ruleType==4?a.pattern=new RegExp(a.patternTemp):o.value.ruleType==5&&(a.validor=`(rule, value, callback) => {
            if (!/(^[1-9]*$)/.test(value)) {
              callback(new Error("请输入数字值"))
            } else {
              if (value > ${a.maxValue}) {
                callback(new Error("${a.message}"))
              } else if(value < ${a.minValue}){
                callback(new Error("${a.message}"))
              }else {
                callback()
              }
            }
          }`),a.ruleType=o.value.ruleType,C.value.value=a,g.value.close()}}}}),ge={key:0,class:"weight"},ve={key:0,class:"collapse_enums"},ye={key:1},Ce={key:2},Fe={key:0,class:"sqlDialog",style:{padding:"20px",height:"100%"}};function De(e,l,w,V,A,B){const D=X,p=x,C=ee,o=le,b=k("Delete"),h=ae,F=ue,g=te,E=oe,a=ne,n=se,s=ie,j=k("codemirror"),N=re,$=k("CustomDialog"),q=k("Dynamicform"),T=de,M=me;return r(),c("div",{class:z(["starfish-formitem starfish-formitem-rule",{formCover:e.drag,"starfish-vertical":e.labelalign!="top"}])},[v("div",{class:z(["label","label_"+e.labelalign]),style:J({width:e.labelWidth+"px"})},[v("label",null,Q(e.item.data.label),1),e.item.data.required?(r(),c("span",ge,"*")):y("",!0),e.item.data.tip?(r(),_(D,{key:1,class:"item",effect:"dark",content:e.item.data.tip,placement:"bottom-start"},{default:t(()=>[...l[2]||(l[2]=[v("span",{class:"tip iconfontui icon-tishi"},null,-1)])]),_:1},8,["content"])):y("",!0)],6),v("div",{class:"control",style:J({marginLeft:e.labelalign!="top"?e.labelWidth+"px":""})},[Array.isArray(e.data[e.item.data.fieldName])&&e.data[e.item.data.fieldName].length>0?(r(),_(g,{key:0},{default:t(()=>[(r(!0),c(R,null,S(e.data[e.item.data.fieldName],(i,I)=>(r(),_(F,{title:i.title,name:i.title,key:I},{default:t(()=>[i.type=="enum"?(r(),c("div",ve,[u(C,{modelValue:i.value,"onUpdate:modelValue":f=>i.value=f,placeholder:"请选择",style:{width:"100%"},size:"mini"},{default:t(()=>[(r(!0),c(R,null,S(e.ruleList,f=>(r(),_(p,{key:f.value,label:f.label,value:f.validator},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])])):y("",!0),i.type=="func"?(r(),c("div",ye,[u(o,{type:"primary",onClick:f=>e.handleFuncEdit(i),size:"mini"},{default:t(()=>[...l[3]||(l[3]=[m("函数编辑",-1)])]),_:1},8,["onClick"])])):y("",!0),i.type=="high"?(r(),c("div",Ce,[u(o,{type:"primary",onClick:f=>e.handleFormEdit(i),size:"mini"},{default:t(()=>[...l[4]||(l[4]=[m("规则表单编辑",-1)])]),_:1},8,["onClick"])])):y("",!0),u(o,{type:"danger",circle:"",onClick:f=>e.deleteRule(I),style:{"margin-left":"10px"}},{default:t(()=>[u(h,null,{default:t(()=>[u(b)]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["title","name"]))),128))]),_:1})):y("",!0),u(n,{onCommand:e.handleDropdown,style:{"margin-top":"10px"}},{dropdown:t(()=>[u(a,null,{default:t(()=>[u(E,{command:"enum"},{default:t(()=>[...l[6]||(l[6]=[m("默认枚举",-1)])]),_:1}),u(E,{command:"func"},{default:t(()=>[...l[7]||(l[7]=[m("自定义函数规则",-1)])]),_:1}),u(E,{command:"high"},{default:t(()=>[...l[8]||(l[8]=[m("高级模式",-1)])]),_:1})]),_:1})]),default:t(()=>[u(o,{type:"success"},{default:t(()=>[...l[5]||(l[5]=[m(" 新增规则",-1),v("i",{class:"el-icon-arrow-down el-icon--right"},null,-1)])]),_:1})]),_:1},8,["onCommand"])],4),u($,{ref:"codeMyDialog"},{default:t(()=>[e.funcItem?(r(),c("div",Fe,[u(C,{modelValue:e.funcValue.trigger,"onUpdate:modelValue":l[0]||(l[0]=i=>e.funcValue.trigger=i),placeholder:"请选择",size:"mini",style:{"margin-bottom":"20px"}},{default:t(()=>[u(p,{label:"blur",value:"blur"}),u(p,{label:"change",value:"change"})]),_:1},8,["modelValue"]),u(s,{title:"rule是存放接收参数的对象;value是待校验的值;callback是回调函数(校验完后，要执行的操作，如抛错),mainData为表单数据",type:"success",style:{"margin-bottom":"15px"}}),l[9]||(l[9]=v("div",null,"(rule, value, callback, mainData) => {",-1)),u(j,{modelValue:e.funcValue.func,"onUpdate:modelValue":l[1]||(l[1]=i=>e.funcValue.func=i),ref:"cm",placeholder:"",mode:"text/javascript",style:{height:"320px"},autofocus:!0,"indent-with-tab":!0,"tab-size":2},null,8,["modelValue"]),l[10]||(l[10]=v("div",null,"}",-1))])):y("",!0),u(N,{class:"my-Footer",style:{height:"60px","text-align":"right"}},{default:t(()=>[u(o,{onClick:e.saveFunc,type:"primary"},{default:t(()=>[...l[11]||(l[11]=[m("保存",-1)])]),_:1},8,["onClick"]),u(o,{onClick:e.closeDialog},{default:t(()=>[...l[12]||(l[12]=[m("关闭",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},512),u($,{ref:"formRuleDialog"},{default:t(()=>[u(T,{style:{padding:"0"}},{default:t(()=>[u(M,{style:{height:"100%"}},{default:t(()=>[u(T,{class:"my-pageMain",style:{overflow:"hidden"}},{default:t(()=>[u(q,{ref:"formdragger",formResult:e.formValue,allFormList:e.ruleJson,globalConfig:Object.assign({},e.globalDatas,{size:"large"})},null,8,["formResult","allFormList","globalConfig"])]),_:1}),u(N,{class:"my-Footer",style:{height:"60px","text-align":"right"}},{default:t(()=>[u(o,{type:"primary",onClick:e.saveField},{default:t(()=>[...l[13]||(l[13]=[m("保存",-1)])]),_:1},8,["onClick"]),u(o,{onClick:e.closeDialog},{default:t(()=>[...l[14]||(l[14]=[m("关闭",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},512)],2)}const he=L(pe,[["render",De]]);export{he as default};
